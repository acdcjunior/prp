<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings
 	xmlns="http://java.sun.com/xml/ns/persistence/orm" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm
						http://java.sun.com/xml/ns/persistence/orm_1_0.xsd"
	version="1.0">
	
	<named-query name="Movimentacao.findByDescricao1">
		<query>
			SELECT 
				m
			FROM 
				Movimentacao m
			WHERE
				m.descricao1 = :descricao1
		</query>
	</named-query>
	
	<named-query name="Movimentacao.findByRealiza">
		<query>
			SELECT 
				m
			FROM 
				Movimentacao m
			WHERE
				m.realiza = :previsao
		</query>
	</named-query>
	
	<named-query name="Movimentacao.sumValorByRealiza">
		<query>
			SELECT 
				sum(m.valor)
			FROM 
				Movimentacao m
			WHERE
				m.realiza = :previsao
		</query>
	</named-query>
	
	
	
	<named-query name="Movimentacao.findByPrevisaoAnoMesCategoria">
		<query>
			SELECT
				m
			FROM
				Movimentacao m
			WHERE
				m.realiza IN (
					SELECT
						p
					FROM
						Previsao p
					WHERE
						YEAR(p.data) = :ano AND MONTH(p.data) = :mes
						AND p.categoria = :categoria
				)
		</query>
	</named-query>
	
	
	
	<named-query name="Movimentacao.findByAnoMesSemCategoria">
		<query>
			SELECT
				m
			FROM
				Movimentacao m
			WHERE
				YEAR(m.data) = :ano AND
				MONTH(m.data) = :mes AND
				m.realiza IS NULL
		</query>
	</named-query>
	
	
	
	<named-query name="Movimentacao.sumValorByPrevisaoAnoMesCategoria">
		<query>
			SELECT
				sum(m.valor)
			FROM
				Movimentacao m
			WHERE
				m.realiza IN (
					SELECT
						p
					FROM
						Previsao p
					WHERE
						YEAR(p.data) = :ano AND MONTH(p.data) = :mes
						AND p.categoria = :categoria
				)
		</query>
	</named-query>
	
	
	
	<named-query name="Movimentacao.sumValorByAnoMesSemRealizacao">
		<query>
			SELECT
				sum(m.valor)
			FROM
				Movimentacao m
			WHERE
				YEAR(m.data) = :ano AND
				MONTH(m.data) = :mes AND
				m.realiza is null
		</query>
	</named-query>
	
	
	
	<named-query name="Movimentacao.countByAnoMesSemRealizacao">
		<query>
			SELECT
				count(m)
			FROM
				Movimentacao m
			WHERE
				YEAR(m.data) = :ano AND
				MONTH(m.data) = :mes AND
				m.realiza is null
		</query>
	</named-query>
	
	
	
	<named-query name="Movimentacao.findPrimeiraMovimentacaoDoMes">
		<query>
			SELECT
				m
			FROM
				Movimentacao m
			WHERE
				YEAR(m.data) = :ano AND MONTH(m.data) = :mes
				AND
				(YEAR(m.anterior.data) != :ano OR MONTH(m.anterior.data) != :mes)
		</query>
	</named-query>
	
	
	
	<named-query name="Movimentacao.findUltimaMovimentacaoDoMes">
		<query>
			SELECT
				m.anterior
			FROM
				Movimentacao m
			WHERE
				(YEAR(m.data) != :ano OR MONTH(m.data) != :mes)
				AND
				(YEAR(m.anterior.data) = :ano AND MONTH(m.anterior.data) = :mes)
		</query>
	</named-query>
	
	
	
	<named-query name="Movimentacao.findByAno">
		<query>
			SELECT
				m
			FROM
				Movimentacao m
			WHERE
				YEAR(m.data) = :ano
		</query>
	</named-query>
	
	
	
	<named-query name="Movimentacao.findByAnoMes">
		<query>
			SELECT
				m
			FROM
				Movimentacao m
			WHERE
				YEAR(m.data) = :ano AND MONTH(m.data) = :mes
		</query>
	</named-query>
	
	
	
	<named-query name="Movimentacao.findUltimaMovimentacaoByOrigem">
		<query>
			SELECT
				m
			FROM
				Movimentacao m
			WHERE
				m.origem = :origem
				AND m.id not in (SELECT m2.anterior FROM Movimentacao m2 WHERE m2.origem = :origem)
		</query>
	</named-query>
	
	
	
	<named-query name="Movimentacao.findAnos">
		<query>
			SELECT
				DISTINCT YEAR(m.data)
			FROM
				Movimentacao m
			ORDER BY
				YEAR(m.data)
		</query>
	</named-query>

</entity-mappings>